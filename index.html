<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ÙØ±ÙˆØ´Ú¯Ø§Ù‡ CP Ú©Ø§Ù„Ø§Ù | Ø¹Ù…Ø§Ø¯</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Vazir,sans-serif;background:#0b1020;color:#fff}
header{background:#000;padding:15px;border-bottom:2px solid #2196f3}
h1,h2,h3{margin:10px 0}
button{cursor:pointer;border:none;border-radius:18px;padding:8px 14px;font-family:inherit}
.btn{background:#2196f3;color:#fff}
.btn-success{background:#4caf50}
.btn-danger{background:#dc3545}
.btn-warning{background:#ffc107;color:#000}
.container{max-width:1200px;margin:auto;padding:20px}
.hidden{display:none}
.row{display:flex;gap:10px;flex-wrap:wrap}
.card{background:#111;border:1px solid #2196f3;border-radius:14px;padding:15px}
input,select{width:100%;padding:10px;border-radius:8px;border:none;margin:5px 0}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px}
.product img{width:80px;height:80px;object-fit:contain;border-radius:50%;background:#222}
.price{color:#4caf50;font-size:18px}
.badge{background:#4caf50;border-radius:10px;padding:2px 8px;font-size:12px}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #333;padding:8px;text-align:right}
.game-area{background:#050814;border:2px solid #333;border-radius:10px;height:300px;position:relative;overflow:hidden}
.target{position:absolute;width:40px;height:40px;border-radius:50%;background:#ff5722;display:flex;align-items:center;justify-content:center;cursor:pointer}
footer{background:#000;border-top:2px solid #2196f3;padding:15px;text-align:center}
nav .btn{margin-left:6px}
</style>
</head>
<body>

<header>
  <div class="row" style="justify-content:space-between;align-items:center">
    <h2>ğŸ® ÙØ±ÙˆØ´Ú¯Ø§Ù‡ CP Ú©Ø§Ù„Ø§Ù | Ø¹Ù…Ø§Ø¯</h2>
    <nav id="navAuth">
      <button class="btn" onclick="showLogin()">ÙˆØ±ÙˆØ¯</button>
      <button class="btn" onclick="showRegister()">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
      <button class="btn-danger" onclick="showAdminLogin()">Ø§Ø¯Ù…ÛŒÙ†</button>
    </nav>
    <div id="navUser" class="hidden">
      <span id="navUserName"></span>
      <span class="badge" id="navGames"></span>
      <button class="btn-danger" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
</header>

<div class="container" id="app"></div>

<footer>Â© ÙØ±ÙˆØ´Ú¯Ø§Ù‡ CP Ø¹Ù…Ø§Ø¯</footer>

<script>
// ================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª ==================
const ADMIN = { username:'admin', password:'313Emad!' };

// ================== Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø² ==================
const db = {
  users: () => JSON.parse(localStorage.getItem('users')||'[]'),
  saveUsers: (v)=>localStorage.setItem('users',JSON.stringify(v)),
  products: () => JSON.parse(localStorage.getItem('products')||'null'),
  saveProducts: (v)=>localStorage.setItem('products',JSON.stringify(v)),
  orders: () => JSON.parse(localStorage.getItem('orders')||'[]'),
  saveOrders: (v)=>localStorage.setItem('orders',JSON.stringify(v)),
};

// ================== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ==================
if(!db.products()){
  db.saveProducts([
    {id:1,name:'Ø³ÛŒâ€ŒÙ¾ÛŒ Ø¯ÙˆØ¨Ù„',price:50000,img:'https://rengogame.com/wp-content/uploads/2023/09/cp2x-codm-rengogame.jpg'},
    {id:2,name:'Ø¢ÙØ± ÙˆÛŒÚ˜Ù‡',price:75000,img:'https://rengogame.com/wp-content/uploads/2025/08/battlepass-call-of-duty-mobile-2025.webp'},
    {id:3,name:'Ø¨Ø³ØªÙ‡ Ø·Ù„Ø§ÛŒÛŒ',price:120000,img:'https://rengogame.com/wp-content/uploads/2025/08/cp-fori-call-of-duty-mobile-2025.webp'}
  ]);
}

// ================== ÙˆØ¶Ø¹ÛŒØª ==================
let currentUser = null;
let isAdmin = false;
let cart = [];

// ================== Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ ==================
const today = ()=> new Date().toDateString();
const uid = ()=> 'ORD-'+Math.random().toString(36).slice(2,8).toUpperCase();
const app = document.getElementById('app');

function updateNav(){
  const navAuth=document.getElementById('navAuth');
  const navUser=document.getElementById('navUser');
  if(currentUser){
    navAuth.classList.add('hidden');
    navUser.classList.remove('hidden');
    document.getElementById('navUserName').innerText='ğŸ‘¤ '+currentUser.fullname;
    document.getElementById('navGames').innerText=`Ø¨Ø§Ø²ÛŒ Ø§Ù…Ø±ÙˆØ²: ${3-currentUser.gamesToday}/3`;
  }else{
    navAuth.classList.remove('hidden');
    navUser.classList.add('hidden');
  }
}

// ================== Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ==================
function showRegister(){
  app.innerHTML=`
  <div class="card">
    <h3>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h3>
    <input id="r_fullname" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
    <input id="r_phone" placeholder="Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³">
    <input id="r_email" placeholder="Ø§ÛŒÙ…ÛŒÙ„">
    <input id="r_username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
    <input id="r_password" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
    <button class="btn-success" onclick="register()">Ø«Ø¨Øª</button>
  </div>`;
}
function register(){
  const users=db.users();
  if(users.some(u=>u.username===r_username.value)) return alert('Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ');
  const u={
    id:Date.now(),
    fullname:r_fullname.value,
    phone:r_phone.value,
    email:r_email.value,
    username:r_username.value,
    password:r_password.value, // Ø¯Ù…Ùˆ
    gamesToday:0,
    lastDay:today()
  };
  users.push(u); db.saveUsers(users);
  alert('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ø¯'); showLogin();
}
function showLogin(){
  app.innerHTML=`
  <div class="card">
    <h3>ÙˆØ±ÙˆØ¯</h3>
    <input id="l_user" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
    <input id="l_pass" type="password" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
    <button class="btn" onclick="login()">ÙˆØ±ÙˆØ¯</button>
  </div>`;
}
function login(){
  const u=db.users().find(x=>x.username===l_user.value && x.password===l_pass.value);
  if(!u) return alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ø¯Ø±Ø³Øª');
  if(u.lastDay!==today()){ u.gamesToday=0; u.lastDay=today(); db.saveUsers(db.users().map(x=>x.id===u.id?u:x)); }
  currentUser=u; isAdmin=false; updateNav(); loadShop();
}
function logout(){ currentUser=null; isAdmin=false; cart=[]; updateNav(); app.innerHTML=''; }

// ================== ÙØ±ÙˆØ´Ú¯Ø§Ù‡ ==================
function loadShop(){
  const products=db.products();
  app.innerHTML=`
  <div class="row">
    <div class="card" style="flex:2">
      <h3>ğŸ›’ Ù…Ø­ØµÙˆÙ„Ø§Øª</h3>
      <div class="products">
        ${products.map(p=>`
          <div class="card product">
            <img src="${p.img}">
            <h4>${p.name}</h4>
            <div class="price">${p.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†</div>
            <button class="btn" onclick="addToCart(${p.id})">Ø§ÙØ²ÙˆØ¯Ù†</button>
          </div>`).join('')}
      </div>
    </div>
    <div class="card" style="flex:1">
      <h3>ğŸ§º Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</h3>
      <div id="cartBox"></div>
      <button class="btn-success" onclick="checkout()">Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´</button>
      <hr>
      <button class="btn-warning" onclick="showGame()">ğŸ® CP Ø±Ø§ÛŒÚ¯Ø§Ù†</button>
    </div>
  </div>`;
  renderCart();
}
function addToCart(id){
  const p=db.products().find(x=>x.id===id);
  cart.push(p); renderCart();
}
function renderCart(){
  const box=document.getElementById('cartBox');
  if(!box) return;
  let sum=0;
  box.innerHTML=cart.map(p=>{sum+=p.price; return `<div>${p.name} - ${p.price.toLocaleString()}</div>`}).join('');
  box.innerHTML+=`<hr><b>Ø¬Ù…Ø¹: ${sum.toLocaleString()} ØªÙˆÙ…Ø§Ù†</b>`;
}
function checkout(){
  if(!currentUser) return alert('Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
  const order={
    id:uid(),
    userId:currentUser.id,
    user:currentUser.fullname,
    phone:currentUser.phone,
    email:currentUser.email,
    items:cart.map(p=>p.name),
    total:cart.reduce((a,b)=>a+b.price,0),
    type:'purchase',
    date:new Date().toLocaleString('fa-IR')
  };
  const orders=db.orders(); orders.push(order); db.saveOrders(orders);
  cart=[]; renderCart();
  alert('Ø³ÙØ§Ø±Ø´ Ø«Ø¨Øª Ø´Ø¯\nÚ©Ø¯ Ø³ÙØ§Ø±Ø´: '+order.id+'\nØ§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø§ÛŒØªØ§: @www_313M');
}

// ================== Ø¨Ø§Ø²ÛŒ ==================
function showGame(){
  if(!currentUser) return alert('Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
  if(currentUser.gamesToday>=3) return alert('Ø³Ù‡Ù…ÛŒÙ‡ Ø§Ù…Ø±ÙˆØ² ØªÙ…Ø§Ù… Ø´Ø¯');
  currentUser.gamesToday++; updateNav();
  app.innerHTML=`
  <div class="card">
    <h3>ğŸ¯ Ø¨Ø§Ø²ÛŒ CP Ø±Ø§ÛŒÚ¯Ø§Ù† (Ù‡Ø¯Ù: Û²Û°Û°Û°)</h3>
    <div>Ø§Ù…ØªÛŒØ§Ø²: <b id="score">0</b></div>
    <div class="game-area" id="gameArea"></div>
  </div>`;
  let score=0;
  const area=document.getElementById('gameArea');
  const timer=setInterval(()=>{
    const t=document.createElement('div');
    t.className='target'; t.innerText='ğŸ¯';
    t.style.left=Math.random()*(area.clientWidth-40)+'px';
    t.style.top=Math.random()*(area.clientHeight-40)+'px';
    t.onclick=()=>{ score+=100; document.getElementById('score').innerText=score; t.remove();
      if(score>=2000){ clearInterval(timer); winFreeCP(); }
    };
    area.appendChild(t);
    setTimeout(()=>t.remove(),1200);
  },700);
}
function winFreeCP(){
  const order={
    id:uid(),
    userId:currentUser.id,
    user:currentUser.fullname,
    phone:currentUser.phone,
    email:currentUser.email,
    items:['Û¸Û° CP Ø±Ø§ÛŒÚ¯Ø§Ù†'],
    total:0,
    type:'free',
    date:new Date().toLocaleString('fa-IR')
  };
  const orders=db.orders(); orders.push(order); db.saveOrders(orders);
  alert('ğŸ‰ Ø¨Ø±Ø¯ÛŒ! Ø³ÙØ§Ø±Ø´ Û¸Û° CP Ø«Ø¨Øª Ø´Ø¯\nÚ©Ø¯: '+order.id);
  loadShop();
}

// ================== Ø§Ø¯Ù…ÛŒÙ† ==================
function showAdminLogin(){
  app.innerHTML=`
  <div class="card">
    <h3>ÙˆØ±ÙˆØ¯ Ø§Ø¯Ù…ÛŒÙ†</h3>
    <input id="a_user" placeholder="ÛŒÙˆØ²Ø±Ù†ÛŒÙ…">
    <input id="a_pass" type="password" placeholder="Ù¾Ø³ÙˆØ±Ø¯">
    <button class="btn-danger" onclick="adminLogin()">ÙˆØ±ÙˆØ¯</button>
  </div>`;
}
function adminLogin(){
  if(a_user.value===ADMIN.username && a_pass.value===ADMIN.password){
    isAdmin=true; currentUser=null; updateNav(); adminPanel();
  }else alert('Ø¯Ø³ØªØ±Ø³ÛŒ Ø±Ø¯ Ø´Ø¯');
}
function adminPanel(){
  app.innerHTML=`
  <div class="row">
    <div class="card" style="flex:1">
      <h3>ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
      <table class="table">
        <tr><th>Ù†Ø§Ù…</th><th>ØªÙ…Ø§Ø³</th><th>Ø§ÛŒÙ…ÛŒÙ„</th></tr>
        ${db.users().map(u=>`<tr><td>${u.fullname}</td><td>${u.phone}</td><td>${u.email}</td></tr>`).join('')}
      </table>
    </div>
    <div class="card" style="flex:1">
      <h3>ğŸ“¦ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§</h3>
      <table class="table">
        <tr><th>Ú©Ø¯</th><th>Ú©Ø§Ø±Ø¨Ø±</th><th>Ù†ÙˆØ¹</th><th>Ù…Ø¨Ù„Øº</th></tr>
        ${db.orders().map(o=>`<tr><td>${o.id}</td><td>${o.user}</td><td>${o.type}</td><td>${o.total}</td></tr>`).join('')}
      </table>
    </div>
  </div>
  <div class="card">
    <h3>ğŸ›’ Ù…Ø­ØµÙˆÙ„Ø§Øª</h3>
    ${db.products().map(p=>`
      <div class="row">
        <b>${p.name}</b>
        <input value="${p.price}" onchange="updatePrice(${p.id},this.value)">
      </div>`).join('')}
  </div>`;
}
function updatePrice(id,val){
  const ps=db.products().map(p=>p.id===id?({...p,price:+val}):p);
  db.saveProducts(ps); alert('Ù‚ÛŒÙ…Øª Ø¨Ù‡â€ŒØ±ÙˆØ² Ø´Ø¯');
}
</script>
</body>
</html>
